(function(){var t,s,i,e;e=function(){function t(t){this.config=t,this.context=this.config.context,this.canvas=this.config.canvas,this.move_amount=this.config.move_amount||this.canvas.width/32,this.width=this.config.width||this.canvas.width/8,this.height=this.config.height||this.canvas.height/30,this.x=this.canvas.width/2,this.y=this.canvas.height-this.height/2,this.score=0,this.lives=3}return t.prototype.update=function(t,s){return t?this.x-=this.move_amount:s&&(this.x+=this.move_amount),this.x+this.width/2>this.canvas.width?this.x=this.canvas.width-this.width/2:this.x-this.width/2<0?this.x=0+this.width/2:void 0},t.prototype.draw=function(){return this.context.fillStyle="rgba(128,128,128,.8)",this.context.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)},t}(),t=function(){function t(t){this.config=t,this.context=this.config.context,this.canvas=this.config.canvas,this.radius=this.config.radius||5,this.max_speed=this.config.max_speed||8,this.max_bounce_angle=this.config.max_bounce_angle||5*Math.PI/12,this.x=this.canvas.width/2,this.y=this.canvas.height/2,this.width=2*this.radius,this.height=2*this.radius,this.use_physics=this.config.use_physics||1,this.dx=0,this.dy=this.max_speed,this.was_bad=!1,this.is_dead=!1}return t.prototype.update=function(t,s){var i,e,h,a,n,d,r,o,c,u,l,p,x,f,g,v,y,_,m,w,b;if(this.dx>this.max_speed?this.dx=this.max_speed:this.dx<0&&this.dx<-this.max_speed&&(this.dx=-this.max_speed),this.dy>this.max_speed?this.dy=this.max_speed:this.dy<0&&this.dy<-this.max_speed&&(this.dy=-this.max_speed),this.x+=this.dx,this.y+=this.dy,d=!1,(this.x>=this.canvas.width||this.x<=0)&&(d=!0,this.x-=2*this.dx,this.dx=-this.dx),this.y<=0&&(d=!0,this.y-=2*this.dy,this.dy=-this.dy),this.y>=this.canvas.height)return this.is_dead=!0,!0;for(d&&this.was_bad&&(this.x=this.canvas.width/2,this.y=this.canvas.height/2,this.dx=this.max_speed,this.dy=this.max_speed,this.was_bad=!1,this.is_bad=!1),this.was_bad=d,c=function(t,s,i,e){return!(i>=t+s||t>=i+e)},u=function(t,s,i,e,h,a,n,d){return c(t,i,h,n)&&c(s,e,a,d)},c=u(this.x,this.y,this.radius,this.radius,t.x-t.width/2,t.y-t.height/2,t.width,t.height),c&&(1===this.use_physics?(this.y=2*t.y-(this.y+this.radius)-this.height,this.dy=-this.dy,this.dx=4*(this.x+.5*this.radius-(t.x+t.width/2))/t.width,this.x>t.x&&(this.dx=-this.dx)):2===this.use_physics&&(l=t.x+t.width/2-this.x,o=l/(t.width/2),h=o*this.max_bounce_angle,this.dx=Math.cos(h)*this.max_speed,this.dy=-1*Math.sin(h)*this.max_speed)),b=[],y=0,_=s.length;_>y;y++)a=s[y],a.dead?b.push(void 0):(x=a.x,r=x-a.width/2,p=x+a.width/2,n=r<=(m=this.x)&&p>=m,f=a.y,g=f-a.height/2,e=f+a.height/2,v=g<=(w=this.y)&&e>=w,n&&v?(a.dead=!0,this.dy=-this.dy,i=Math.floor(this.y+.5*this.radius-(a.y-a.height/2)-a.height),0===i&&(this.dy<0?this.dy=-1*this.max_speed:this.dy=this.max_speed),t.score+=100,this.config.use_NLGame?b.push(NLGame.score("player",t.score)):b.push(void 0)):b.push(void 0));return b},t.prototype.draw=function(){return this.context.fillStyle="rgba(255, 255, 255, 1)",this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.context.closePath(),this.context.fill()},t}(),s=function(){function t(t){this.config=t,this.context=this.config.context,this.canvas=this.config.canvas,this.width=this.config.width,this.height=this.config.height,this.color=this.config.color,this.x=this.config.x,this.y=this.config.y,this.dead=!1}return t.prototype.update=function(){return this.dead?void 0:!0},t.prototype.draw=function(){return this.dead?void 0:(this.context.fillStyle=this.color,this.context.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height))},t}(),i=function(){function i(t){this.config=t,this.canvas=null,this.bricks=[],this.ball=null,this.paddle=null,this.spacePressed=this.leftPressed=this.upPressed=this.rightPressed=this.downPressed=this.zPressed=this.aPressed=null}return i.prototype.main=function(){var t,s=this;return this.create_canvas(),this.config.use_NLGame&&NLGame.gameIsReplay||(this.add_key_observers(),t=function(t){var i,e;return t?(i=t.pageX-s.canvas.offsetLeft,e=t.pageY-s.canvas.offsetTop):(t=window.event,i=t.event.offsetX,e=t.event.offsetY),s.paddle.x=i},document.onmousemove=t),this.config.use_NLGame&&(NLGame.updateMouse=function(t,i){return s.paddle.x=t}),this.start_new_game()},i.prototype.start_new_game=function(){var t;return delete this.ball,delete this.paddle,delete this.bricks,this.config.use_NLGame&&(NLGame.start(),NLGame.gameData={},NLGame.gameData.pause=!1),this.spawn_bricks(),this.spawn_ball(),t={context:this.context,canvas:this.canvas,debug:this.config.debug,use_NLGame:this.config.use_NLGame},this.paddle=new e(t),this.update()},i.prototype.spawn_bricks=function(){var t,i,e,h,a,n,d,r,o,c,u,l,p,x;for(this.bricks=[],n=40,d=20,h=20,a=5,e=Math.round(this.canvas.width/d),i=["hsl(  0, 100%, 50%)","hsl( 60, 100%, 50%)","hsl(120, 100%, 50%)","hsl(180, 100%, 50%)","hsl(240, 100%, 50%)","hsl(300, 100%, 50%)"],x=[],u=p=0;a>=0?a>=p:p>=a;u=a>=0?++p:--p)x.push(function(){var a,p;for(p=[],o=a=0;e>=0?e>=a:a>=e;o=e>=0?++a:--a)c=o*d,l=u*h+n,r={x:c,y:l,width:d,height:h,color:i[u],context:this.context,canvas:this.canvas,use_NLGame:this.config.use_NLGame},t=new s(r),p.push(this.bricks.push(t));return p}.call(this));return x},i.prototype.spawn_ball=function(){var s;return s={context:this.context,canvas:this.canvas,debug:this.config.debug,use_NLGame:this.config.use_NLGame,radius:5,max_speed:8,dx:0,dy:0},this.ball=new t(s)},i.prototype.reset=function(){return this.terminate_run_loop=!0,this.clear_screen()},i.prototype.update=function(){var t,s=this;return t=function(){return s.update()},0===this.paddle.lives?(this.config.use_NLGame&&(NLGame.gameData.pause=!0),this.context.fillStyle="rgba(255, 255, 255, 1)",this.context.font="bold 70px sans-serif",this.context.fillText("GAME OVER",this.canvas.width/2-210,this.canvas.height/2+50),this.context.font="bold 24px sans-serif",this.context.fillText("Press 'z' to play again.",this.canvas.width/2-115,this.canvas.height/2+100),this.zPressed?void this.start_new_game():void window.setTimeout(t,1e3/30)):(this.paddle.update(this.leftPressed,this.rightPressed),this.ball.update(this.paddle,this.bricks),this.ball.is_dead&&(this.paddle.lives-=1,this.ball.is_dead=!1,this.paddle.lives>0&&(this.config.use_NLGame&&NLGame.score("computer",(this.paddle.config.lives||3)-this.paddle.lives),this.spawn_ball())),this.draw(),window.setTimeout(t,1e3/30))},i.prototype.draw=function(){var t,s,i,e,h;for(this.clear_screen(),this.context.fillStyle="rgba(0, 0, 0,1)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),s=0,h=this.bricks,i=0,e=h.length;e>i;i++)t=h[i],t.dead||(s+=1,t.draw());return 0===s&&this.spawn_bricks(),this.ball.draw(),this.paddle.draw(),this.context.fillStyle="rgba(255, 0, 0, 1)",this.context.font="bold 12px sans-serif",this.context.fillText("score: "+this.paddle.score,5,15),this.context.fillText("lives: "+this.paddle.lives,100,15)},i.prototype.create_canvas=function(){return this.canvas=document.getElementsByTagName("canvas")[0],this.context=this.canvas.getContext("2d")},i.prototype.clear_screen=function(){return this.context.fillStyle="rgba(0, 0, 0, 1)",this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.add_key_observers=function(){var t=this;return document.addEventListener("keydown",function(s){switch(s.keyCode){case 32:return t.spacePressed=!0;case 37:return t.leftPressed=!0;case 38:return t.upPressed=!0;case 39:return t.rightPressed=!0;case 40:return t.downPressed=!0;case 90:return t.zPressed=!0;case 65:return t.aPressed=!0}},!1),document.addEventListener("keyup",function(s){switch(s.keyCode){case 27:return t.reset();case 32:return t.spacePressed=!1;case 37:return t.leftPressed=!1;case 38:return t.upPressed=!1;case 39:return t.rightPressed=!1;case 40:return t.downPressed=!1;case 90:return t.zPressed=!1;case 65:return t.aPressed=!1}},!1)},i}(),$(document).ready(function(){var t,s;return t={debug:!1,use_NLGame:"undefined"!=typeof NLGame&&null!==NLGame},s=new i(t),s.main()})}).call(this);
